version: '3.8'

services:

  postgres:

    image: postgres:15

    environment:

      POSTGRES_USER: activities_user

      POSTGRES_PASSWORD: activities_pass

      POSTGRES_DB: activities_db

    volumes:

      - postgres_data:/var/lib/postgresql/data

    healthcheck:

      test: ["CMD-SHELL", "pg_isready -U activities_user -d activities_db"]

      interval: 30s

      timeout: 10s

      retries: 3

  backend:

    build:

      context: .

      dockerfile: ./backend/Dockerfile

    environment:

      DATABASE_URL: postgresql://activities_user:activities_pass@postgres:5432/activities_db

      JWT_SECRET_KEY: your-jwt-secret-key-change-in-production

      JWT_ALGORITHM: HS256

      JWT_EXPIRE_MINUTES: 1440

    depends_on:

      postgres:

        condition: service_healthy

  frontend:

    build:

      context: .

      dockerfile: ./frontend/Dockerfile

    environment:

      NEXT_PUBLIC_API_URL: http://89.167.87.232.sslip.io

    depends_on:

      - backend

volumes:

  postgres_data:
